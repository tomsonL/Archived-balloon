var __extends=this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},__define=this.__define||function(t,e,n,i){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:n,set:i})},lark;!function(t){var e;!function(e){var n=function(e){function n(t){var n=this;e.call(this),this.$loop=!1,this.$startTime=0,this.audio=null,this.onPlayEnd=function(){return 0==n.$loop?void n.stop():(n.audio.load(),n.audio.currentTime=n.$startTime,void n.audio.play())},t.addEventListener("ended",this.onPlayEnd),this.audio=t}__extends(n,e);var i=__define,o=n;return p=o.prototype,p.stop=function(){if(this.audio){var e=this.audio;e.pause(),e.removeEventListener("ended",this.onPlayEnd),e.$channel=null,this.audio=null,this.emitWith(t.Event.ENDED),this.$sound.$recycle(e),this.$sound=null}},i(p,"volume",function(){return this.audio?this.audio.volume:1},function(t){this.audio&&(this.audio.volume=t)}),i(p,"position",function(){return this.audio?this.audio.currentTime:0},function(t){this.audio&&this.audio.currentTime!=t&&(this.audio.currentTime=t)}),n}(t.EventEmitter);e.HtmlSoundChannel=n,t.registerClass(n,"lark.web.HtmlSoundChannel",["lark.SoundChannel","lark.IEventEmitter"])}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=function(e){function n(n){var i=this;e.call(this),this.loaded=!1,this.closed=!1,this.heightSet=0/0,this.widthSet=0/0,this._fullscreen=!0,this.onVideoLoaded=function(){i.video.removeEventListener("canplay",i.onVideoLoaded);{var e=i.video;i.width,i.height}i.loaded=!0,e.pause(),i.posterData&&(i.posterData.width=e.videoWidth,i.posterData.height=e.videoHeight),e.width=e.videoWidth,e.height=e.videoHeight,i.$invalidateContentBounds(),i.width=isNaN(i.widthSet)?e.videoWidth:i.widthSet,i.height=isNaN(i.heightSet)?e.videoHeight:i.heightSet,i.emitWith(t.Event.COMPLETE)},this.$renderRegion=new t.sys.Region,this.src=n,this.once(t.Event.ADDED_TO_STAGE,this.loadPoster,this)}__extends(n,e);var i=__define,o=n;return p=o.prototype,p.load=function(t){var e=this;if(t=t||this.src,!this.video||this.video.src!=t){var n=document.createElement("video");n.src=t,n.setAttribute("webkit-playsinline","webkit-playsinline"),n.addEventListener("canplay",this.onVideoLoaded),n.addEventListener("error",function(){return e.onVideoError()}),n.addEventListener("ended",function(){return e.onVideoEnded()}),n.load(),n.play(),setTimeout(function(){return n.pause()},16),this.video=n}},p.play=function(e,n){var i=this;if(void 0===n&&(n=!1),0==this.loaded)return this.load(),void this.once(t.Event.COMPLETE,function(){return i.play(e,n)},this);var o=this.video;void 0!=e&&(o.currentTime=+e||0),o.loop=!!n,o.play(),o.style.position="absolute",o.style.top="0px",o.style.left="0px",o.style.height="0",o.style.width="0",document.body.appendChild(o);var r=!1;this._fullscreen&&(r=this.goFullscreen()),0==r&&(o.setAttribute("webkit-playsinline","webkit-playsinline"),t.startTick(this.markDirty,this))},p.goFullscreen=function(){var e=this,n=this.video;if(n.webkitRequestFullscreen)n.webkitRequestFullscreen();else if(n.webkitRequestFullScreen)n.webkitRequestFullScreen();else if(n.msRequestFullscreen)n.msRequestFullscreen();else{if(!n.requestFullscreen)return!1;n.requestFullscreen()}return n.removeAttribute("webkit-playsinline"),n.onwebkitfullscreenchange=function(){var t=!!n.webkitDisplayingFullscreen;t||e.pause()},n.onwebkitfullscreenerror=function(){t.$error(3003)},!0},p.close=function(){this.pause(),0==this.loaded&&this.video&&(this.video.src=""),this.video&&(this.video.remove&&this.video.remove(),this.video=null),this.closed=!0,this.loaded=!1},p.pause=function(){this.video&&(this.video.pause(),this.onVideoEnded()),t.stopTick(this.markDirty,this)},i(p,"volume",function(){return this.video?this.video.volume:1},function(t){this.video&&(this.video.volume=t)}),i(p,"position",function(){return this.video?this.video.currentTime:0},function(t){this.video&&(this.video.currentTime=t)}),i(p,"fullscreen",function(){return this._fullscreen},function(t){this._fullscreen=!!t,this.video&&0==this.video.paused&&this.goFullscreen()}),i(p,"bitmapData",function(){return this.video&&this.loaded?(this._bitmapData||(this.video.width=this.video.videoWidth,this.video.height=this.video.videoHeight,this._bitmapData=t.web.toBitmapData(this.video)),this._bitmapData):null}),p.loadPoster=function(){var e=this,n=this.poster;if(n){var i=new t.ImageLoader;i.once(t.Event.COMPLETE,function(){var t=i.data;e.posterData=i.data,e.video&&e.loaded?(t.width=e.video.videoWidth,t.height=e.video.videoHeight):(t.width=isNaN(e.widthSet)?t.width:e.widthSet,t.height=isNaN(e.heightSet)?t.height:e.heightSet),e.$invalidateContentBounds()},this),i.load(n)}},p.onVideoEnded=function(){this.emitWith(t.Event.ENDED),this.$invalidateContentBounds()},p.onVideoError=function(){this.emitWith(t.Event.IO_ERROR)},p.$measureContentBounds=function(t){var e=this.bitmapData,n=this.posterData;e?t.setTo(0,0,e.width,e.height):n?t.setTo(0,0,n.width,n.height):t.setEmpty()},p.$render=function(t){var e=this.bitmapData,n=this.posterData;(!e||this.video&&this.video.paused)&&n&&t.drawImage(n,0,0,n.width,n.height),e&&(t.imageSmoothingEnabled=!0,t.drawImage(e,0,0,e.width,e.height))},p.markDirty=function(){return this.$invalidate(),!0},p.$setHeight=function(t){e.prototype.$setHeight.call(this,t),this.heightSet=+t||0},p.$setWidth=function(t){e.prototype.$setWidth.call(this,t),this.widthSet=+t||0},n}(t.DisplayObject);e.WebVideo=n,t.registerClass(n,"lark.web.WebVideo",["lark.Video"]),t.Video=n}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=function(e){function n(n,i){var o=this;e.call(this),this.onTouchBegin=function(t){var e=o.getLocation(t);o.touch.onTouchBegin(e.x,e.y,t.identifier)},this.onTouchMove=function(t){var e=o.getLocation(t);o.touch.onTouchMove(e.x,e.y,t.identifier)},this.onTouchEnd=function(t){var e=o.getLocation(t);o.touch.onTouchEnd(e.x,e.y,t.identifier)},this.scaleX=1,this.scaleY=1,this.rotation=0,this.canvas=i,this.touch=new t.sys.TouchHandler(n),this.addListeners()}__extends(n,e);var i=n;return p=i.prototype,p.addListeners=function(){var e=this;window.navigator.msPointerEnabled?(this.canvas.addEventListener("MSPointerDown",function(t){e.onTouchBegin(t),e.prevent(t)},!1),this.canvas.addEventListener("MSPointerMove",function(t){e.onTouchMove(t),e.prevent(t)},!1),this.canvas.addEventListener("MSPointerUp",function(t){e.onTouchEnd(t),e.prevent(t)},!1)):(t.Capabilities.$isMobile||this.addMouseListener(),this.addTouchListener())},p.addMouseListener=function(){this.canvas.addEventListener("mousedown",this.onTouchBegin),this.canvas.addEventListener("mousemove",this.onTouchMove),window.addEventListener("mouseup",this.onTouchEnd)},p.addTouchListener=function(){var t=this;this.canvas.addEventListener("touchstart",function(e){for(var n=e.changedTouches.length,i=0;n>i;i++)t.onTouchBegin(e.changedTouches[i]);t.prevent(e)},!1),this.canvas.addEventListener("touchmove",function(e){for(var n=e.changedTouches.length,i=0;n>i;i++)t.onTouchMove(e.changedTouches[i]);t.prevent(e)},!1),this.canvas.addEventListener("touchend",function(e){for(var n=e.changedTouches.length,i=0;n>i;i++)t.onTouchEnd(e.changedTouches[i]);t.prevent(e)},!1),this.canvas.addEventListener("touchcancel",function(e){for(var n=e.changedTouches.length,i=0;n>i;i++)t.onTouchEnd(e.changedTouches[i]);t.prevent(e)},!1)},p.prevent=function(t){t.stopPropagation(),1==t.isScroll||this.canvas.userTyping||t.preventDefault()},p.getLocation=function(e){e.identifier=+e.identifier||0;var n=document.documentElement,i=this.canvas.getBoundingClientRect(),o=i.left+window.pageXOffset-n.clientLeft,r=i.top+window.pageYOffset-n.clientTop,a=e.pageX-o,s=a,l=e.pageY-r,h=l;return 90==this.rotation?(s=l,h=i.width-a):-90==this.rotation&&(s=i.height-l,h=a),s/=this.scaleX,h/=this.scaleY,t.$TempPoint.setTo(Math.round(s),Math.round(h))},p.updateScaleMode=function(t,e,n){this.scaleX=t,this.scaleY=e,this.rotation=n},n}(t.LarkObject);e.WebTouchHandler=n,t.registerClass(n,"lark.web.WebTouchHandler")}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=function(n){function i(e){var i=this;n.call(this),this.audios=[],this.loaded=!1,this.closed=!1,this.onAudioLoaded=function(){i.loaded=!0,i.originAudio.removeEventListener("canplaythrough",i.onAudioLoaded),i.emitWith(t.Event.COMPLETE)},this.url=e}__extends(i,n);var o=i;return p=o.prototype,p.load=function(t){var e=this;t=t||this.url;var n=new Audio(t);n.addEventListener("canplaythrough",this.onAudioLoaded),n.addEventListener("error",function(){return e.onAudioError()}),n.load(),this.originAudio=n,this.audios.push(n)},p.play=function(t,n){void 0===t&&(t=0),void 0===n&&(n=!1);var i=this.audios.pop();void 0==i?(i=this.originAudio.cloneNode(),i.addEventListener("canplaythrough",function(){return i.currentTime=t})):i.currentTime=t,i.loop=!!n;var o=new e.HtmlSoundChannel(i);return o.$sound=this,o.$loop=n,o.$startTime=t,i.play(),o},p.close=function(){0==this.loaded&&this.originAudio&&(this.originAudio.src=""),this.originAudio&&(this.originAudio=null),this.audios&&(this.audios.length=0),this.closed=!0},p.$recycle=function(t){this.closed||this.audios.push(t)},p.onAudioError=function(){this.emitWith(t.Event.IO_ERROR)},i}(t.EventEmitter);e.HtmlSound=n,t.registerClass(n,"lark.web.HtmlSound",["lark.Sound","lark.IEventEmitter"]),t.Sound=n}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=function(){function e(){}var n=e;return p=n.prototype,e.detect=function(){var n=t.Capabilities,i=navigator.userAgent.toLowerCase();n.$isMobile=-1!=i.indexOf("mobile")||-1!=i.indexOf("android"),n.$isMobile?i.indexOf("windows")<0&&(-1!=i.indexOf("iphone")||-1!=i.indexOf("ipad")||-1!=i.indexOf("ipod"))?n.$os="iOS":-1!=i.indexOf("android")&&-1!=i.indexOf("linux")?n.$os="Android":-1!=i.indexOf("windows")&&(n.$os="Windows Phone"):-1!=i.indexOf("windows nt")?n.$os="Windows PC":-1!=i.indexOf("mac os")&&(n.$os="Mac OS");var o=e.checkHtml5Support();n.$hasGeolocation=o.geo,n.$hasMotion=o.m,n.$hasOrientation=o.ortt;var r=(navigator.language||navigator.browserLanguage).toLowerCase(),a=r.split("-");a.length>1&&(a[1]=a[1].toUpperCase()),n.$language=a.join("-"),n.$devicePixelRatio=window.devicePixelRatio||1},e.checkHtml5Support=function(){var t=("webkitAudioContext"in window||"AudioContext"in window,"geolocation"in navigator),e="DeviceOrientationEvent"in window,n="DeviceMotionEvent"in window;return{geo:t,ortt:e,m:n}},e}();e.WebCapability=n,t.registerClass(n,"lark.web.WebCapability"),n.detect()}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){function n(t){return null==a&&(a=i()),a+t.charAt(0).toUpperCase()+t.substr(1)}function i(){for(var t=document.createElement("div").style,e="",n=["t","webkitT","msT","MozT","OT"],i=0;i<n.length;i++){var o=n[i]+"ransform";o in t&&(e=n[i])}return e.substr(0,e.length-1)}var o=new t.Point,r=function(e){function i(n,i,o){var r=this;e.call(this),this.scaleX=1,this.scaleY=1,this.offsetX=1,this.offsetY=1,this.anchorX=0,this.anchorY=0,this.rotation=0,this.pendingToShowHtmlInput=!1,this.currentTextInput=null,this.singleLineTextInput=null,this.multiLineTextInput=null,this.lastSelectAnchor=0,this.lastSelectActive=0,this.handleContainerClick=function(t){if(r.pendingToShowHtmlInput){r.pendingToShowHtmlInput=!1,t.stopImmediatePropagation(),r.$initializeInput();var e=r.currentHtmlInput;e.onblur=r.handleHtmlInputBlur,e.oninput=r.handleHtmlInputInputEvent,e.focus(),e.onclick=r.getInputSelection,e.onselect=r.getInputSelection,e.onkeydown=r.getInputSelection,r.$selectRange(r.currentTextInput.selectionActivePosition,r.currentTextInput.selectionAnchorPosition),r.getInputSelection(),r.currentTextInput.$startInput()}else null!=r.currentTextInput&&r.$removeCurrentTextInput()},this.handleHtmlInputInputEvent=function(){r.currentTextInput.$setUserInputText(r.currentHtmlInput.value),r.getInputSelection()},this.handleHtmlInputBlur=function(){var t=(r.currentHtmlInput,r.currentTextInput);r.$removeCurrentTextInput(),t.selectRange(r.lastSelectAnchor,r.lastSelectActive)},this.getInputSelection=function(){var t=r.currentHtmlInput.selectionEnd,e=r.currentHtmlInput.selectionStart,n=r.currentHtmlInput.selectionDirection||"forward";r.lastSelectAnchor="forward"==n?e:t,r.lastSelectActive="forward"==n?t:e},this.$stage=i,this.canvas=o,this.container=n,t.sys.$cacheTextAdapter(this),this.createHtmlInputs()}__extends(i,e);var r=i;return p=r.prototype,p.$setCurrentTextInput=function(t){null!=this.currentTextInput&&this.$removeCurrentTextInput(),this.currentTextInput=t,this.currentHtmlInput=t.wordWrap?this.multiLineTextInput:this.singleLineTextInput,t.displayAsPassword&&(this.currentHtmlInput=this.singleLineTextInput),this.currentHtmlInput.value=this.currentTextInput.text,this.pendingToShowHtmlInput=!0,this.canvas.userTyping=!0},p.$removeCurrentTextInput=function(){window.scrollTo(0,0);var t=this.currentTextInput,e=this.currentHtmlInput;e.onblur=null,e.oninput=null,e.onclick=null,e.onselect=null,e.onkeydown=null,this.resetHtmlInputStyle(e),this.resetTextContainerStyle(),t.$setUserInputText(e.value),t.$endInput(),this.currentHtmlInput=null,this.currentTextInput=null,this.pendingToShowHtmlInput=!1,this.canvas.userTyping=!1},p.updateScaleMode=function(t,e,n,i,o,r,a){void 0===a&&(a=0),this.scaleX=t,this.scaleY=e,this.offsetX=n,this.offsetY=i,this.anchorX=o,this.anchorY=r,this.rotation=a},p.createHtmlInputs=function(){var t=document.createElement("div");this.textContainer=t,t.id="text-container-"+this.hashCode,this.resetTextContainerStyle();var e=document.createElement("input");e.type="text";var n=document.createElement("textarea");n.style.resize="none",this.resetHtmlInputStyle(e),this.resetHtmlInputStyle(n),t.appendChild(e),t.appendChild(n),this.container.appendChild(t),this.singleLineTextInput=e,this.multiLineTextInput=n,this.canvas.addEventListener("click",this.handleContainerClick)},p.resetHtmlElementStyle=function(t){t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style.border="none",t.style.padding="2px 0",t.style[n("transformOrigin")]="0% 0% 0px"},p.resetHtmlInputStyle=function(t){t.setAttribute("tabindex","-1"),t.style.width="1px",t.style.height="12px",t.style.outline="thin",t.style.background="none",t.style.overflow="hidden",t.style.wordBreak="break-all",t.style.opacity="0",this.resetHtmlElementStyle(t)},p.resetTextContainerStyle=function(){var t=this.textContainer.style;t.height="0px",t.width="0px",t.top="-100px",this.resetHtmlElementStyle(this.textContainer)},p.$initializeInput=function(){this.singleLineTextInput.style.display="none",this.multiLineTextInput.style.display="none";var e=this.currentTextInput,i=this.currentHtmlInput;i.type=e.displayAsPassword?"password":"text";var r=this.scaleX,a=this.scaleY,s=e.$getConcatenatedMatrix().clone();s.scale(r,a);var l=e.localToGlobal(0,0,o),h=this.offsetX+l.x*r,u=this.offsetY+l.y*a;this.textContainer.style.left=h+"px",this.textContainer.style.top=u+"px",r=s.$getScaleX(),a=s.$getScaleY();var d=e.width*r,c=e.height*a;this.textContainer.style.width=d+"px",this.textContainer.style.height=c+"px",this.textContainer.style[n("transformOrigin")]=""+(this.anchorX+this.offsetX-h)+"px "+(this.anchorY+this.offsetY-u)+"px",this.textContainer.style[n("transform")]="rotate("+this.rotation+"deg)";var p=this.setElementStyle.bind(this);if(p("fontFamily",e.fontFamily),p("fontStyle",e.italic?"italic":"normal"),p("fontWeight",e.bold?"bold":"normal"),p("textAlign",e.textAlign),p("fontSize",e.fontSize+"px"),p("lineHeight",e.fontSize+"px"),p("color",t.sys.toColorString(e.textColor)),p("verticalAlign",e.verticalAlign),p("display","block"),p("width",e.width+"px"),p("height",e.height+"px"),p(n("transform"),"matrix("+[s.a,s.b,s.c,s.d,0,0].join(",")+")"),setTimeout(function(){i.style.opacity="1"},0),0==e.wordWrap&&e.verticalAlign!=t.VerticalAlign.MIDDLE){var v=e.height-e.fontSize+2,f=e.verticalAlign==t.VerticalAlign.TOP?"paddingBottom":"paddingTop";p(f,v+"px"),p("height",e.fontSize+"px")}e.text!=i.value&&(i.value=e.text),0!=e.maxChars?i.maxLength=e.maxChars:i.maxLength>=0&&(i.maxLength=8388608)},p.$selectRange=function(t,e){var n=Math.min(t,e),i=Math.max(t,e);this.currentHtmlInput.setSelectionRange(n,i,e>t?"forward":"backward")},p.setElementStyle=function(t,e){this.currentHtmlInput&&(this.currentHtmlInput.style[t]=e)},i}(t.LarkObject);e.WebTextAdapter=r,t.registerClass(r,"lark.web.WebTextAdapter",["lark.sys.ITextAdapter"]);var a=null}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=function(e){function n(){var n=this;e.call(this),this._url="",this.onReadyStateChange=function(){var e=n._xhr;if(4==e.readyState){var i=e.status>=400||0==e.status,o=(n._url,n);setTimeout(function(){o.emitWith(i?t.Event.IO_ERROR:t.Event.COMPLETE)},0)}},this.updateProgress=function(e){e.lengthComputable&&t.ProgressEvent.emitProgressEvent(n,t.ProgressEvent.PROGRESS,e.loaded,e.total)},this._xhr=new XMLHttpRequest,this._xhr.onreadystatechange=this.onReadyStateChange,this._xhr.onprogress=this.updateProgress}__extends(n,e);var i=__define,o=n;return p=o.prototype,i(p,"response",function(){return this._xhr.response?this._xhr.response:this._xhr.responseXML?this._xhr.responseXML:this._xhr.responseText?this._xhr.responseText:null}),i(p,"responseType",function(){return this._xhr.responseType},function(t){this._xhr.responseType=t}),i(p,"withCredentials",function(){return this._xhr.withCredentials},function(t){this._xhr.withCredentials=!!t}),p.open=function(t,e){void 0===e&&(e="GET"),this._url=t,this._xhr.open(e,t,!0)},p.send=function(t){this._xhr.send(t)},p.abort=function(){this._xhr.abort()},p.getAllResponseHeaders=function(){var t=this._xhr.getAllResponseHeaders();return t?t:""},p.setRequestHeader=function(t,e){this._xhr.setRequestHeader(t,e)},p.getResponseHeader=function(t){var e=this._xhr.getResponseHeader(t);return e?e:""},n}(t.EventEmitter);e.WebHttpRequest=n,t.registerClass(n,"lark.web.WebHttpRequest",["lark.HttpRequest"]),t.HttpRequest=n}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=window.URL||window.webkitURL,i=n&&"iOS"==t.Capabilities.os;if(i){var o=window.navigator.userAgent.toLowerCase().match(/cpu [^\d]*\d.*like mac os x/)[0];parseInt(o.match(/\d(_\d)*/)[0].charAt(0))<7&&(i=!1)}var r=function(o){function r(){var n=this;o.apply(this,arguments),this.data=null,this.crossOrigin=null,this.currentImage=null,this.request=null,this.onImageComplete=function(i){var o=n.getImage(i);if(o){n.data=e.toBitmapData(o);var r=n;setTimeout(function(){r.emitWith(t.Event.COMPLETE)},0)}},this.onLoadError=function(t){var e=n.getImage(t);e&&n.emitIOError(e.src)}}__extends(r,o);var a=r;return p=a.prototype,p.load=function(e){if(i&&0!=e.indexOf("data:")&&0!=e.indexOf("http:")&&0!=e.indexOf("https:")){var n=this.request;n||(n=this.request=new t.web.WebHttpRequest,n.on(t.Event.COMPLETE,this.onBlobLoaded,this),n.on(t.Event.IO_ERROR,this.onBlobError,this),n.responseType="blob"),n.open(e),n.send()}else this.loadImage(e)},p.onBlobLoaded=function(){var t=this.request.response;this.loadImage(n.createObjectURL(t))},p.onBlobError=function(){this.emitIOError(this.currentURL)},p.loadImage=function(t){var e=new Image;this.data=null,this.currentImage=e,this.crossOrigin&&(e.crossOrigin=this.crossOrigin),e.onload=this.onImageComplete,e.onerror=this.onLoadError,e.src=t},p.emitIOError=function(e){var n=this;setTimeout(function(){n.emitWith(t.Event.IO_ERROR)},0)},p.getImage=function(t){var e=t.target;return i&&n.revokeObjectURL(e.src),e.onerror=null,e.onload=null,this.currentImage!==e?null:(this.currentImage=null,e)},r}(t.EventEmitter);e.WebImageLoader=r,t.registerClass(r,"lark.web.WebImageLoader",["lark.ImageLoader"]),t.ImageLoader=r}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=function(e){function n(){var n=this;e.apply(this,arguments),this.onChange=function(e){var i=new t.MotionEvent(t.Event.CHANGE),o={x:e.acceleration.x,y:e.acceleration.y,z:e.acceleration.z},r={x:e.accelerationIncludingGravity.x,y:e.accelerationIncludingGravity.y,z:e.accelerationIncludingGravity.z},a={alpha:e.rotationRate.alpha,beta:e.rotationRate.beta,gamma:e.rotationRate.gamma};i.acceleration=o,i.accelerationIncludingGravity=r,i.rotationRate=a,n.emit(i)}}__extends(n,e);var i=n;return p=i.prototype,p.start=function(){window.addEventListener("devicemotion",this.onChange)},p.stop=function(){window.removeEventListener("devicemotion",this.onChange)},n}(t.EventEmitter);e.WebMotion=n,t.registerClass(n,"lark.web.WebMotion",["lark.Motion","lark.IEventEmitter"]),t.Motion=t.web.WebMotion}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=function(e){function n(){var n=this;e.apply(this,arguments),this.onChange=function(e){var i=new t.OrientationEvent(t.Event.CHANGE);i.beta=e.beta,i.gamma=e.gamma,i.alpha=e.alpha,n.emit(i)}}__extends(n,e);var i=n;return p=i.prototype,p.start=function(){window.addEventListener("deviceorientation",this.onChange)},p.stop=function(){window.removeEventListener("deviceorientation",this.onChange)},n}(t.EventEmitter);e.WebOrientation=n,t.registerClass(n,"lark.web.WebOrientation",["lark.Orientation","lark.IEventEmitter"])}(e=t.web||(t.web={}))}(lark||(lark={})),lark.Orientation=lark.web.WebOrientation,void 0==window.HTMLVideoElement&&(window.HTMLVideoElement=HTMLDivElement);var lark;!function(t){var e;!function(e){function n(e){return e.hashCode=e.$hashCode=t.$hashCount++,e}var i="lark.BitmapData";t.registerClass(HTMLImageElement,i),t.registerClass(HTMLCanvasElement,i),t.registerClass(HTMLVideoElement,i),e.toBitmapData=n}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){function n(t){for(var e=s.parseFromString(t,"text/xml"),n=e.childNodes.length,o=0;n>o;o++){var r=e.childNodes[o];if(1===r.nodeType)return i(r,null)}return null}function i(t,e){if("parsererror"==t.localName)throw new Error(t.textContent);for(var n=new r(t.localName,e,t.prefix,t.namespaceURI,t.nodeName),o=t.attributes,s=n.attributes,l=o.length,h=0;l>h;h++){var u=o[h],d=u.name;0!==d.indexOf("xmlns:")&&(s[d]=u.value)}var c=t.childNodes;l=c.length;var p=n.children;for(h=0;l>h;h++){var v=c[h],f=v.nodeType,g=null;if(1===f)g=i(v,n);else if(3===f){var m=v.textContent.trim();m&&(g=new a(m,n))}g&&p.push(g)}return n}var o=function(){function t(t,e){this.nodeType=t,this.parent=e}var e=t;return p=e.prototype,t}();e.XMLNode=o,t.registerClass(o,"lark.web.XMLNode");var r=function(t){function e(e,n,i,o,r){t.call(this,1,n),this.attributes={},this.children=[],this.localName=e,this.prefix=i,this.namespace=o,this.name=r}__extends(e,t);var n=e;return p=n.prototype,e}(o);e.XML=r,t.registerClass(r,"lark.web.XML");var a=function(t){function e(e,n){t.call(this,3,n),this.text=e}__extends(e,t);var n=e;return p=n.prototype,e}(o);e.XMLText=a,t.registerClass(a,"lark.web.XMLText");var s=new DOMParser;t.XML={parse:n}}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=function(e){function n(){var n=this;e.call(this),this.onUpdate=function(e){var i=new t.GeolocationEvent(t.Event.CHANGE),o=e.coords;i.altitude=o.altitude,i.heading=o.heading,i.accuracy=o.accuracy,i.latitude=o.latitude,i.longitude=o.longitude,i.speed=o.speed,i.altitudeAccuracy=o.altitudeAccuracy,n.emit(i)},this.onError=function(e){var i=t.GeolocationEvent.UNAVAILABLE;e.code==e.PERMISSION_DENIED&&(i=t.GeolocationEvent.PERMISSION_DENIED);var o=new t.GeolocationEvent(t.Event.IO_ERROR);o.errorType=i,o.errorMessage=e.message,n.emit(o)},this.geolocation=navigator.geolocation}__extends(n,e);var i=n;return p=i.prototype,p.start=function(){var e=this.geolocation;e?this.watchId=e.watchPosition(this.onUpdate,this.onError):this.onError({code:2,message:t.sys.tr(3004),PERMISSION_DENIED:1,POSITION_UNAVAILABLE:2})},p.stop=function(){var t=this.geolocation;t.clearWatch(this.watchId)},n}(t.EventEmitter);e.WebGeolocation=n,t.registerClass(n,"lark.web.WebGeolocation",["lark.Geolocation","lark.IEventEmitter"]),t.Geolocation=t.web.WebGeolocation}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=[],i=-1!=navigator.userAgent.indexOf("QQBrowser"),o=function(){function o(){t.sys.sharedRenderContext=this.create().renderContext;for(var e=0;3>e;e++)n.push(this.create())}var r=o;return p=r.prototype,p.create=function(e){var o=e||n.length>3?n.pop():null;if(!o){var r=document.createElement("canvas");if(r.width=r.height=1,i&&!this.testCanvasValid(r))return t.warn("failed to create canvas!"),null;o=this.createSurface(r)}return o},p.release=function(t){t&&(t.width=t.height=1,n.push(t))},p.testCanvasValid=function(t){t.height=1,t.width=1;var e=t.toDataURL("image/png");return"data:,"==e?!1:!0},p.createSurface=function(t){var n=t.getContext("2d");t.renderContext=n,n.surface=t,e.toBitmapData(t);var i=n.drawImage;if(n.drawImage=function(t){t&&0!==t.width&&0!==t.height&&i.apply(n,arguments)},void 0===n.imageSmoothingEnabled){for(var o=["webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled"],r=o.length-1;r>=0;r--){var a=o[r];if(void 0!==n[a])break}try{Object.defineProperty(n,"imageSmoothingEnabled",{get:function(){return this[a]},set:function(t){this[a]=t}})}catch(s){n.imageSmoothingEnabled=n[a]}}return t},o}();e.CanvasFactory=o,t.registerClass(o,"lark.web.CanvasFactory",["lark.sys.SurfaceFactory"])}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=function(n){function i(t){n.call(this),this.init(t)}__extends(i,n);var o=i;return p=o.prototype,p.init=function(n){var i=this.readOption(n),o=new t.Stage;o.$screen=this,o.$scaleMode=i.scaleMode,o.$highResolutionMode=i.highResolutionMode,o.frameRate=i.frameRate;var r=t.sys.surfaceFactory.create(),a=r;this.attachCanvas(n,a);var s=new e.WebTouchHandler(o,a),l=new e.WebTextAdapter(n,o,a),h=new t.sys.Player(r.renderContext,o,i.entryClassName);this.playerOption=i,this.container=n,this.canvas=a,this.stage=o,this.player=h,this.webTextAdapter=l,this.webTouchHandler=s,this.updateScreenSize(),h.start()},p.readOption=function(e){var n={};n.entryClassName=e.getAttribute("data-entry-class"),n.scaleMode=e.getAttribute("data-scale-mode")||t.StageScaleMode.NO_SCALE,n.frameRate=+e.getAttribute("data-frame-rate")||30,n.contentWidth=+e.getAttribute("data-content-width")||480,n.contentHeight=+e.getAttribute("data-content-height")||800,n.orientation=e.getAttribute("data-orientation")||t.sys.OrientationMode.AUTO,n.highResolutionMode=e.getAttribute("data-resolution-mode")||t.sys.HighResolutionMode.DEFAULT;return n},p.attachCanvas=function(t,e){var n=e.style;n.cursor="default",n.position="absolute",n.top="0",n.bottom="0",n.left="0",n.right="0",t.appendChild(e),n=t.style,n.overflow="hidden",n.position="relative"},p.updateScreenSize=function(){var e=this.canvas,n=this.playerOption,i=t.Capabilities.devicePixelRatio,o=1,r=this.container.getBoundingClientRect(),a=this.calculateOrientationMode(n,r),s=a.shouldRotate,l=a.rotation,h=this.stage.$scaleMode,u=this.stage.$highResolutionMode,d=s?r.height:r.width,c=s?r.width:r.height,p=t.sys.screenAdapter.calculateStageSize(h,d,c,n.contentWidth,n.contentHeight),v=p.stageWidth,f=p.stageHeight,g=p.displayWidth,m=p.displayHeight,w=v,y=f;u!=t.sys.HighResolutionMode.DEFAULT&&(w*=i,y*=i,u==t.sys.HighResolutionMode.DEVICE&&(v*=i,f*=i),u==t.sys.HighResolutionMode.RETINA&&(o=i)),e.style.width=g+"px",e.style.height=m+"px",e.style.top=(r.height-m)/2+"px",e.style.left=(r.width-g)/2+"px",e.width!==w&&(e.width=w),e.height!==y&&(e.height=y);var E="rotate("+l+"deg)";e.style.webkitTransform=E,e.style.transform=E,this.player.updateStageSize(v,f,o);var b=g/v,x=m/f;this.webTouchHandler.updateScaleMode(b,x,l),this.webTextAdapter.updateScaleMode(b,x,(r.width-g)/2,(r.height-m)/2,g/2,m/2,l)},p.calculateOrientationMode=function(e,n){var i=!1,o=0;return e.orientation!=t.sys.OrientationMode.AUTO&&(i=e.orientation!=t.sys.OrientationMode.PORTRAIT&&n.height>n.width||e.orientation==t.sys.OrientationMode.PORTRAIT&&n.width>n.height),i&&(o=e.orientation==t.sys.OrientationMode.LANDSCAPE?90:-90),{shouldRotate:i,rotation:o}},i}(t.LarkObject);e.WebPlayer=n,t.registerClass(n,"lark.web.WebPlayer",["lark.sys.Screen"])}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){function n(){t.Capabilities.$devicePixelRatio=window.devicePixelRatio||1;for(var e=document.querySelectorAll(".lark-player"),n=e.length,i=0;n>i;i++){var o=e[i],r=o["lark-player"];r.updateScreenSize()}}function i(){var n=t.sys.$ticker=new t.sys.Ticker;o(n);var i=new e.CanvasFactory;t.sys.surfaceFactory=i,t.sys.screenAdapter||(t.sys.screenAdapter=new t.sys.ScreenAdapter);for(var r=document.querySelectorAll(".lark-player"),a=r.length,s=0;a>s;s++){var l=r[s],h=new e.WebPlayer(l);l["lark-player"]=h}}function o(t){function e(){t.update(),n.call(window,e)}var n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;n||(n=function(t){return window.setTimeout(t,1e3/60)}),n.call(window,e)}function r(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e}e.updateAllScreens=n,window.isNaN=function(t){return t=+t,t!==t},t.warn=function(){console.warn.apply(console,r(arguments))},t.error=function(){console.error.apply(console,r(arguments))},t.assert=function(){console.assert.apply(console,r(arguments))},t.log=function(){console.log.apply(console,r(arguments))},window.addEventListener("load",i),window.addEventListener("resize",n)}(e=t.web||(t.web={}))}(lark||(lark={}));